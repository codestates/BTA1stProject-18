{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchJson = void 0;\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\nconst providers_1 = require(\"../providers\");\nconst errors_1 = require(\"./errors\");\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\nasync function fetchJson(connectionInfoOrUrl, json) {\n  let connectionInfo = {\n    url: null\n  };\n  if (typeof connectionInfoOrUrl === 'string') {\n    connectionInfo.url = connectionInfoOrUrl;\n  } else {\n    connectionInfo = connectionInfoOrUrl;\n  }\n  const response = await exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, async () => {\n    try {\n      const response = await fetch(connectionInfo.url, {\n        method: json ? 'POST' : 'GET',\n        body: json ? json : undefined,\n        headers: {\n          ...connectionInfo.headers,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        if (response.status === 503) {\n          errors_1.logWarning(`Retrying HTTP request for ${connectionInfo.url} as it's not available now`);\n          return null;\n        }\n        throw http_errors_1.default(response.status, await response.text());\n      }\n      return response;\n    } catch (error) {\n      if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n        errors_1.logWarning(`Retrying HTTP request for ${connectionInfo.url} because of error: ${error}`);\n        return null;\n      }\n      throw error;\n    }\n  });\n  if (!response) {\n    throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${connectionInfo.url}.`, 'RetriesExceeded');\n  }\n  return await response.json();\n}\nexports.fetchJson = fetchJson;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","fetchJson","http_errors_1","require","exponential_backoff_1","providers_1","errors_1","START_WAIT_TIME_MS","BACKOFF_MULTIPLIER","RETRY_NUMBER","connectionInfoOrUrl","json","connectionInfo","url","response","default","fetch","method","body","undefined","headers","ok","status","logWarning","text","error","toString","includes","TypedError"],"sources":["/Users/dahan/Desktop/blockchain/BTA1stProject-18/near-pocket/node_modules/near-api-js/lib/utils/web.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fetchJson = void 0;\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\nconst providers_1 = require(\"../providers\");\nconst errors_1 = require(\"./errors\");\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\nasync function fetchJson(connectionInfoOrUrl, json) {\n    let connectionInfo = { url: null };\n    if (typeof (connectionInfoOrUrl) === 'string') {\n        connectionInfo.url = connectionInfoOrUrl;\n    }\n    else {\n        connectionInfo = connectionInfoOrUrl;\n    }\n    const response = await exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, async () => {\n        try {\n            const response = await fetch(connectionInfo.url, {\n                method: json ? 'POST' : 'GET',\n                body: json ? json : undefined,\n                headers: { ...connectionInfo.headers, 'Content-Type': 'application/json' }\n            });\n            if (!response.ok) {\n                if (response.status === 503) {\n                    errors_1.logWarning(`Retrying HTTP request for ${connectionInfo.url} as it's not available now`);\n                    return null;\n                }\n                throw http_errors_1.default(response.status, await response.text());\n            }\n            return response;\n        }\n        catch (error) {\n            if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n                errors_1.logWarning(`Retrying HTTP request for ${connectionInfo.url} because of error: ${error}`);\n                return null;\n            }\n            throw error;\n        }\n    });\n    if (!response) {\n        throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${connectionInfo.url}.`, 'RetriesExceeded');\n    }\n    return await response.json();\n}\nexports.fetchJson = fetchJson;\n"],"mappings":"AAAA,YAAY;;AACZ,IAAIA,eAAe,GAAI,IAAI,IAAI,IAAI,CAACA,eAAe,IAAK,UAAUC,GAAG,EAAE;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAU,GAAID,GAAG,GAAG;IAAE,SAAS,EAAEA;EAAI,CAAC;AAC7D,CAAC;AACDE,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,SAAS,GAAG,KAAK,CAAC;AAC1B,MAAMC,aAAa,GAAGR,eAAe,CAACS,OAAO,CAAC,aAAa,CAAC,CAAC;AAC7D,MAAMC,qBAAqB,GAAGV,eAAe,CAACS,OAAO,CAAC,uBAAuB,CAAC,CAAC;AAC/E,MAAME,WAAW,GAAGF,OAAO,CAAC,cAAc,CAAC;AAC3C,MAAMG,QAAQ,GAAGH,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMI,kBAAkB,GAAG,IAAI;AAC/B,MAAMC,kBAAkB,GAAG,GAAG;AAC9B,MAAMC,YAAY,GAAG,EAAE;AACvB,eAAeR,SAAS,CAACS,mBAAmB,EAAEC,IAAI,EAAE;EAChD,IAAIC,cAAc,GAAG;IAAEC,GAAG,EAAE;EAAK,CAAC;EAClC,IAAI,OAAQH,mBAAoB,KAAK,QAAQ,EAAE;IAC3CE,cAAc,CAACC,GAAG,GAAGH,mBAAmB;EAC5C,CAAC,MACI;IACDE,cAAc,GAAGF,mBAAmB;EACxC;EACA,MAAMI,QAAQ,GAAG,MAAMV,qBAAqB,CAACW,OAAO,CAACR,kBAAkB,EAAEE,YAAY,EAAED,kBAAkB,EAAE,YAAY;IACnH,IAAI;MACA,MAAMM,QAAQ,GAAG,MAAME,KAAK,CAACJ,cAAc,CAACC,GAAG,EAAE;QAC7CI,MAAM,EAAEN,IAAI,GAAG,MAAM,GAAG,KAAK;QAC7BO,IAAI,EAAEP,IAAI,GAAGA,IAAI,GAAGQ,SAAS;QAC7BC,OAAO,EAAE;UAAE,GAAGR,cAAc,CAACQ,OAAO;UAAE,cAAc,EAAE;QAAmB;MAC7E,CAAC,CAAC;MACF,IAAI,CAACN,QAAQ,CAACO,EAAE,EAAE;QACd,IAAIP,QAAQ,CAACQ,MAAM,KAAK,GAAG,EAAE;UACzBhB,QAAQ,CAACiB,UAAU,CAAE,6BAA4BX,cAAc,CAACC,GAAI,4BAA2B,CAAC;UAChG,OAAO,IAAI;QACf;QACA,MAAMX,aAAa,CAACa,OAAO,CAACD,QAAQ,CAACQ,MAAM,EAAE,MAAMR,QAAQ,CAACU,IAAI,EAAE,CAAC;MACvE;MACA,OAAOV,QAAQ;IACnB,CAAC,CACD,OAAOW,KAAK,EAAE;MACV,IAAIA,KAAK,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,YAAY,CAAC,IAAIF,KAAK,CAACC,QAAQ,EAAE,CAACC,QAAQ,CAAC,iBAAiB,CAAC,EAAE;QACzFrB,QAAQ,CAACiB,UAAU,CAAE,6BAA4BX,cAAc,CAACC,GAAI,sBAAqBY,KAAM,EAAC,CAAC;QACjG,OAAO,IAAI;MACf;MACA,MAAMA,KAAK;IACf;EACJ,CAAC,CAAC;EACF,IAAI,CAACX,QAAQ,EAAE;IACX,MAAM,IAAIT,WAAW,CAACuB,UAAU,CAAE,YAAWnB,YAAa,iBAAgBG,cAAc,CAACC,GAAI,GAAE,EAAE,iBAAiB,CAAC;EACvH;EACA,OAAO,MAAMC,QAAQ,CAACH,IAAI,EAAE;AAChC;AACAZ,OAAO,CAACE,SAAS,GAAGA,SAAS"},"metadata":{},"sourceType":"script"}